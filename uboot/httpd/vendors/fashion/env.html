<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<title>环境变量设置</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<div class="main-container">
		<nav class="side-nav">
			<a href="index.html" class="nav-item"><span>📦固件更新</span></a>
			<a href="uboot.html" class="nav-item"><span>🚀UBOOT更新</span></a>
			<a href="art.html" class="nav-item"><span>📶ART更新</span></a>
			<a href="mibib.html" class="nav-item"><span>📊MIBIB更新</span></a>
			<a href="mac.html" class="nav-item"><span>🛠️MAC管理</span></a>
			<a href="env.html" class="nav-item active"><span>⚙️环境变量◀</span></a>
		</nav>
		<main class="content-area">
			<section class="content-page active" id="page-env">
				<h1>⚙️环境变量设置</h1>
				<div class="upload-card">
					<form id="env-form" autocomplete="off">
						<div class="form-group">
							<label for="env-var">变量名(例如：bootcmd/ipaddr/serverip/single_part/all)</label>
							<input type="text" id="env-var" class="form-control" required>
						</div>
						<div class="form-group">
							<label for="env-val">变量值（留空仅查询）</label>
							<input type="text" id="env-val" class="form-control">
						</div>
						<button type="submit" class="submit-btn">查询/修改</button>
					</form>
					<!-- 新增重启按钮 -->
					<button type="button" class="submit-btn reboot-btn" id="reboot-btn">重启设备</button>
				</div>
				<div class="notice-box" id="env-result"></div>
			</section>
		</main>
	</div>
	<script>
	document.getElementById('env-form').onsubmit = function(e){
		e.preventDefault();
		var v = document.getElementById('env-var').value.trim();
		var val = document.getElementById('env-val').value.trim();
		var result = document.getElementById('env-result');
		if (!v) {
			result.textContent = '请输入变量名';
			result.className = 'notice-box danger';
			return;
		}
		result.textContent = '处理中...';
		result.className = 'notice-box';
		var body = 'var=' + encodeURIComponent(v);
		if (val) body += '&val=' + encodeURIComponent(val);
		fetch('/setenv', {
			method: 'POST',
			headers: {'Content-Type': 'application/x-www-form-urlencoded'},
			body: body
		}).then(r=>r.text()).then(t=>{
			result.textContent = t;
			if(t.indexOf('Success')!==-1 || t.indexOf('Value:')!==-1) {
				result.className = 'notice-box success';
				// 查询到值时自动填充到输入框
				var m = t.match(/Value:\s*\S+=(.*)/);
				if(m) document.getElementById('env-val').value = m[1];
			} else {
				result.className = 'notice-box danger';
			}
		});
	};

	// 重启按钮JS
	document.getElementById('reboot-btn').onclick = function(){
		if(confirm('确定要重启设备吗？')) {
			fetch('/reset', {method:'POST'})
			.then(r=>r.text())
			.then(t=>{
				alert('设备正在重启！\n' + t);
			});
		}
	};
	</script>
</body>
</html>
